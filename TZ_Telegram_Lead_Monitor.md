# ТЕХНИЧЕСКОЕ ЗАДАНИЕ

## Веб-сервис мониторинга и реагирования на сообщения в Telegram

### «Telegram Lead Monitor»

**Версия документа:** 1.0  
**Дата:** Декабрь 2025

---

## Содержание

1. [Введение](#1-введение)
2. [Общее описание системы](#2-общее-описание-системы)
3. [Функциональные требования](#3-функциональные-требования)
4. [Нефункциональные требования](#4-нефункциональные-требования)
5. [Внешние интеграции](#5-внешние-интеграции)
6. [Модель данных](#6-модель-данных)
7. [Спецификация API](#7-спецификация-api)
8. [Требования к интерфейсу](#8-требования-к-интерфейсу)
9. [Технологический стек](#9-технологический-стек)
10. [План разработки](#10-план-разработки)
11. [Риски и митигации](#11-риски-и-митигации)
12. [Приложения](#12-приложения)

---

## 1. Введение

### 1.1. Назначение документа

Настоящее техническое задание определяет требования к разработке SaaS-платформы для мониторинга сообщений в Telegram-каналах и чатах с целью выявления релевантных бизнес-возможностей. Система предназначена для автоматизации поиска потенциальных клиентов, кандидатов и других лидов на основе анализа публичного контента в Telegram.

### 1.2. Целевая аудитория продукта

- **Менеджеры по продажам** — поиск потенциальных клиентов, выявление интереса к продуктам/услугам
- **HR-специалисты и рекрутеры** — мониторинг сообщений о поиске работы, пассивный рекрутинг
- **Маркетологи** — анализ упоминаний бренда, конкурентная разведка
- **Владельцы бизнеса** — выявление потребностей рынка, поиск партнёров
- **Инвестиционные аналитики** — отслеживание новостей о стартапах и сделках

### 1.3. Бизнес-цели

- Автоматизация рутинного мониторинга множества Telegram-каналов
- Сокращение времени от появления возможности до реакции на неё
- Увеличение конверсии за счёт своевременного outreach
- Создание масштабируемого SaaS-продукта с подписной моделью монетизации

---

## 2. Общее описание системы

### 2.1. Концепция продукта

Telegram Lead Monitor — это веб-платформа, которая подключается к Telegram через MTProto API (userbot), мониторит выбранные каналы и чаты, анализирует сообщения с помощью LLM и уведомляет пользователя о релевантных находках. Критерии релевантности задаются пользователем в формате промта для языковой модели.

### 2.2. Ключевые особенности

- **MTProto интеграция** — мониторинг публичных каналов без добавления бота, работа от имени пользователя
- **LLM-анализ** — гибкие критерии релевантности через промты, понимание контекста и намерений
- **TGStat интеграция** — поиск каналов по ключевым словам, аналитика и статистика
- **Мультитенантность** — полная изоляция данных между аккаунтами, подписочная модель
- **Уведомления** — мгновенные алерты в Telegram, email, webhook

### 2.3. Высокоуровневая архитектура

Система состоит из следующих основных компонентов:

```
┌─────────────────────────────────────────────────────────────────────┐
│                           FRONTEND (SPA)                            │
│                    Next.js + Tailwind + shadcn/ui                   │
└─────────────────────────────────┬───────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────┐
│                           BACKEND API                               │
│                      FastAPI / NestJS + JWT                         │
└───────┬─────────────────────┬─────────────────────┬─────────────────┘
        │                     │                     │
        ▼                     ▼                     ▼
┌───────────────┐    ┌────────────────┐    ┌───────────────────┐
│   TELEGRAM    │    │    MESSAGE     │    │   NOTIFICATION    │
│   CONNECTOR   │    │   PROCESSOR    │    │     SERVICE       │
│   (Telethon)  │    │  (LLM + Queue) │    │ (TG Bot/Email/WH) │
└───────┬───────┘    └────────┬───────┘    └───────────────────┘
        │                     │
        ▼                     ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         DATA LAYER                                  │
│            PostgreSQL + Redis + Meilisearch (optional)              │
└─────────────────────────────────────────────────────────────────────┘
```

- **Frontend (SPA)** — веб-интерфейс для управления подписками, настройки правил, просмотра лидов
- **Backend API** — REST/GraphQL API для взаимодействия с frontend и внешними сервисами
- **Telegram Connector** — сервис подключения к Telegram через MTProto (Telethon/Pyrogram)
- **Message Processor** — очередь обработки сообщений и вызов LLM для анализа
- **Notification Service** — рассылка уведомлений о найденных лидах
- **Database Layer** — PostgreSQL для данных, Redis для кэша и очередей

---

## 3. Функциональные требования

### 3.1. Модуль аутентификации и управления пользователями

| ID | Требование |
|----|------------|
| AUTH-01 | Регистрация пользователей через email с подтверждением |
| AUTH-02 | OAuth 2.0 авторизация через Google, GitHub |
| AUTH-03 | Двухфакторная аутентификация (TOTP) |
| AUTH-04 | Управление профилем: смена пароля, настройки уведомлений |
| AUTH-05 | Роли внутри организации: владелец, администратор, участник |
| AUTH-06 | Приглашение членов команды в workspace |

### 3.2. Модуль подключения Telegram-аккаунта

| ID | Требование |
|----|------------|
| TG-01 | Авторизация в Telegram через QR-код или код из SMS |
| TG-02 | Безопасное хранение session-данных (шифрование at rest) |
| TG-03 | Управление несколькими Telegram-аккаунтами в рамках workspace |
| TG-04 | Отображение статуса подключения (online, requires reauth, banned) |
| TG-05 | Автоматическое переподключение при разрыве сессии |

### 3.3. Модуль управления источниками (каналы и чаты)

| ID | Требование |
|----|------------|
| SRC-01 | Добавление каналов/чатов вручную по username или ссылке |
| SRC-02 | Поиск каналов через TGStat API по ключевым словам, категориям, регионам |
| SRC-03 | Импорт списка каналов из CSV/Excel |
| SRC-04 | Отображение статистики канала (подписчики, ERR, среднее количество постов) |
| SRC-05 | Группировка каналов в папки/теги для организации |
| SRC-06 | Включение/отключение мониторинга отдельных источников |
| SRC-07 | Рекомендации похожих каналов на основе уже добавленных |

### 3.4. Модуль правил мониторинга (Monitoring Rules)

| ID | Требование |
|----|------------|
| RULE-01 | Создание правил с понятным названием и описанием |
| RULE-02 | Настройка промта для LLM: описание критериев релевантности |
| RULE-03 | Шаблоны промтов для типовых кейсов (продажи, HR, конкуренты) |
| RULE-04 | Привязка правила к конкретным источникам или ко всем |
| RULE-05 | Настройка порога confidence score для срабатывания |
| RULE-06 | Расписание активности правила (только в рабочие часы, 24/7) |
| RULE-07 | Тестирование правила на исторических сообщениях |
| RULE-08 | A/B тестирование разных промтов для оптимизации качества |

### 3.5. Модуль обработки сообщений

| ID | Требование |
|----|------------|
| MSG-01 | Real-time получение новых сообщений через MTProto |
| MSG-02 | Предварительная фильтрация по ключевым словам (опционально, для экономии) |
| MSG-03 | Batch-обработка сообщений для оптимизации вызовов LLM |
| MSG-04 | Поддержка нескольких LLM-провайдеров (OpenAI, Anthropic, self-hosted) |
| MSG-05 | Структурированный вывод: score, reasoning, extracted entities |
| MSG-06 | Дедупликация похожих сообщений (forwards, reposts) |
| MSG-07 | Обработка медиа: извлечение текста из изображений (OCR) — опционально |

### 3.6. Модуль лидов и уведомлений

| ID | Требование |
|----|------------|
| LEAD-01 | Лента найденных лидов с фильтрацией и сортировкой |
| LEAD-02 | Карточка лида: исходное сообщение, ссылка, контекст, оценка LLM |
| LEAD-03 | Статусы лидов: новый, в работе, обработан, архив |
| LEAD-04 | Назначение лида на члена команды |
| LEAD-05 | Комментарии и заметки к лидам |
| LEAD-06 | Push-уведомления в Telegram-бота |
| LEAD-07 | Email-дайджесты (мгновенные, ежечасные, ежедневные) |
| LEAD-08 | Webhook для интеграции с CRM/другими системами |
| LEAD-09 | Быстрые действия: перейти в канал, написать автору (если доступно) |

### 3.7. Модуль аналитики и отчётов

| ID | Требование |
|----|------------|
| ANAL-01 | Dashboard с ключевыми метриками: лиды/день, конверсия, активность каналов |
| ANAL-02 | Графики динамики лидов по времени |
| ANAL-03 | Рейтинг источников по качеству лидов |
| ANAL-04 | Статистика по правилам: срабатывания, false positives |
| ANAL-05 | Экспорт данных в CSV/Excel |
| ANAL-06 | Трекинг использования лимитов (API calls, сообщения) |

### 3.8. Модуль биллинга и подписок

| ID | Требование |
|----|------------|
| BILL-01 | Тарифные планы с разными лимитами (Free, Pro, Enterprise) |
| BILL-02 | Интеграция с платёжным провайдером (Stripe, ЮKassa) |
| BILL-03 | Управление подпиской: апгрейд, даунгрейд, отмена |
| BILL-04 | История платежей и счета |
| BILL-05 | Trial-период для новых пользователей |

---

## 4. Нефункциональные требования

### 4.1. Производительность

| ID | Требование |
|----|------------|
| PERF-01 | Время обработки сообщения от получения до уведомления: < 30 секунд |
| PERF-02 | Поддержка до 1000 активных каналов на аккаунт |
| PERF-03 | Обработка до 100,000 сообщений в день на инстанс |
| PERF-04 | Время отклика API: p95 < 200ms |
| PERF-05 | Горизонтальное масштабирование Telegram Connector |

### 4.2. Надёжность и доступность

| ID | Требование |
|----|------------|
| REL-01 | SLA: 99.5% uptime для API и dashboard |
| REL-02 | Автоматический failover для критических компонентов |
| REL-03 | Graceful degradation при недоступности LLM провайдера |
| REL-04 | Ежедневные бэкапы базы данных с retention 30 дней |
| REL-05 | Очередь сообщений с персистентностью (не терять сообщения при перезапуске) |

### 4.3. Безопасность

| ID | Требование |
|----|------------|
| SEC-01 | Шифрование данных at rest (AES-256) и in transit (TLS 1.3) |
| SEC-02 | Изоляция данных между tenant'ами на уровне БД |
| SEC-03 | Хранение Telegram session-ключей в отдельном зашифрованном хранилище |
| SEC-04 | Rate limiting для защиты от abuse |
| SEC-05 | Аудит-лог действий пользователей |
| SEC-06 | Соответствие требованиям GDPR (право на удаление данных) |
| SEC-07 | Регулярные security-аудиты и penetration testing |

### 4.4. Масштабируемость

| ID | Требование |
|----|------------|
| SCALE-01 | Микросервисная архитектура с независимым масштабированием компонентов |
| SCALE-02 | Kubernetes-ready с Helm charts |
| SCALE-03 | Stateless сервисы (кроме Telegram Connector) |
| SCALE-04 | Database sharding при росте beyond 1M пользователей |

---

## 5. Внешние интеграции

### 5.1. Telegram MTProto

| Параметр | Значение |
|----------|----------|
| Библиотека | Telethon (Python) или Pyrogram |
| Функции | Авторизация, подписка на каналы, получение сообщений, информация о пользователях |
| Ограничения | Соблюдение rate limits Telegram, риск бана при агрессивном использовании |

### 5.2. TGStat API

**Документация:** https://api.tgstat.ru/docs/ru/start/intro.html

Используемые методы:

- `channels/search` — поиск каналов по ключевым словам
- `channels/get` — информация о канале
- `channels/stat` — статистика канала
- `words/mentions` — упоминания ключевых слов

### 5.3. LLM провайдеры

| Провайдер | Модели | Использование |
|-----------|--------|---------------|
| OpenAI | GPT-4o-mini, GPT-4o | Массовая обработка, сложные кейсы |
| Anthropic | Claude 3.5 Sonnet | Альтернатива OpenAI |
| Self-hosted | vLLM, Ollama | Enterprise-клиенты |

### 5.4. Платёжные системы

| Провайдер | Функции |
|-----------|---------|
| Stripe | Международные платежи, подписки, invoicing |
| ЮKassa | Платежи для РФ |

### 5.5. Дополнительные интеграции

| Сервис | Назначение |
|--------|------------|
| SendGrid / Amazon SES | Транзакционные письма |
| Telegram Bot API | Отправка уведомлений пользователям |
| Webhooks | Интеграция с CRM (Bitrix24, AmoCRM, HubSpot) |
| Sentry | Мониторинг ошибок и exceptions |

---

## 6. Модель данных

### 6.1. Основные сущности

```
┌─────────────────────────────────────────────────────────────────────┐
│                            TENANTS                                  │
│  id | name | plan | settings | created_at | updated_at              │
└─────────────────────────────────┬───────────────────────────────────┘
                                  │ 1:N
                                  ▼
┌─────────────────────────────────────────────────────────────────────┐
│                             USERS                                   │
│  id | tenant_id | email | password_hash | role | created_at         │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                       TELEGRAM_ACCOUNTS                             │
│  id | tenant_id | phone | session_encrypted | status | created_at   │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                            SOURCES                                  │
│  id | tenant_id | tg_id | type | username | title | is_active       │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                             RULES                                   │
│  id | tenant_id | name | prompt | threshold | schedule | is_active  │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                           MESSAGES                                  │
│  id | source_id | tg_message_id | text | author_id | sent_at        │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                             LEADS                                   │
│  id | tenant_id | message_id | rule_id | score | status | assignee  │
└─────────────────────────────────────────────────────────────────────┘
```

### 6.2. Детализация таблиц

#### tenants
```sql
CREATE TABLE tenants (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    plan VARCHAR(50) DEFAULT 'free',
    settings JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    deleted_at TIMESTAMP
);
```

#### users
```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID REFERENCES tenants(id),
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255),
    role VARCHAR(50) DEFAULT 'member',
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
CREATE INDEX idx_users_tenant ON users(tenant_id);
```

#### telegram_accounts
```sql
CREATE TABLE telegram_accounts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID REFERENCES tenants(id),
    phone VARCHAR(20) NOT NULL,
    session_encrypted BYTEA NOT NULL,
    status VARCHAR(50) DEFAULT 'active',
    last_active_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW()
);
CREATE INDEX idx_tg_accounts_tenant ON telegram_accounts(tenant_id);
```

#### sources
```sql
CREATE TABLE sources (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID REFERENCES tenants(id),
    telegram_account_id UUID REFERENCES telegram_accounts(id),
    tg_id BIGINT NOT NULL,
    type VARCHAR(20) NOT NULL, -- 'channel', 'chat', 'group'
    username VARCHAR(255),
    title VARCHAR(255),
    subscribers_count INT,
    is_active BOOLEAN DEFAULT true,
    tags TEXT[],
    created_at TIMESTAMP DEFAULT NOW()
);
CREATE INDEX idx_sources_tenant ON sources(tenant_id);
CREATE INDEX idx_sources_tg_id ON sources(tg_id);
```

#### rules
```sql
CREATE TABLE rules (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID REFERENCES tenants(id),
    name VARCHAR(255) NOT NULL,
    description TEXT,
    prompt TEXT NOT NULL,
    threshold DECIMAL(3,2) DEFAULT 0.70,
    schedule JSONB DEFAULT '{"always": true}',
    source_ids UUID[], -- NULL = all sources
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
CREATE INDEX idx_rules_tenant ON rules(tenant_id);
```

#### messages
```sql
CREATE TABLE messages (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    source_id UUID REFERENCES sources(id),
    tg_message_id BIGINT NOT NULL,
    text TEXT,
    author_tg_id BIGINT,
    author_username VARCHAR(255),
    media_type VARCHAR(50),
    sent_at TIMESTAMP NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);
CREATE INDEX idx_messages_source ON messages(source_id);
CREATE INDEX idx_messages_sent_at ON messages(sent_at);
-- Partitioning by month recommended for high volume
```

#### leads
```sql
CREATE TABLE leads (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID REFERENCES tenants(id),
    message_id UUID REFERENCES messages(id),
    rule_id UUID REFERENCES rules(id),
    score DECIMAL(3,2) NOT NULL,
    reasoning TEXT,
    extracted_entities JSONB,
    status VARCHAR(50) DEFAULT 'new',
    assignee_id UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
CREATE INDEX idx_leads_tenant_status ON leads(tenant_id, status);
CREATE INDEX idx_leads_created ON leads(created_at);
```

### 6.3. Примечания к модели данных

- Все таблицы включают audit-поля: `created_at`, `updated_at`, `deleted_at` (soft delete)
- `tenant_id` присутствует во всех пользовательских таблицах для изоляции данных
- Сообщения хранятся с TTL (90 дней по умолчанию) для управления объёмом
- Индексы на часто используемых фильтрах: `tenant_id`, `status`, `created_at`

---

## 7. Спецификация API

### 7.1. Общие принципы

- REST API с JSON-ответами
- Версионирование через URL prefix: `/api/v1/`
- Аутентификация: Bearer JWT токен в заголовке Authorization
- Стандартизированные коды ошибок и формат ответа
- OpenAPI 3.0 спецификация для документации

### 7.2. Формат ответов

**Успешный ответ:**
```json
{
  "success": true,
  "data": { ... },
  "meta": {
    "page": 1,
    "per_page": 20,
    "total": 150
  }
}
```

**Ошибка:**
```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid email format",
    "details": { ... }
  }
}
```

### 7.3. Эндпоинты

#### Аутентификация

| Метод | Эндпоинт | Описание |
|-------|----------|----------|
| POST | `/api/v1/auth/register` | Регистрация |
| POST | `/api/v1/auth/login` | Вход |
| POST | `/api/v1/auth/refresh` | Обновление токена |
| POST | `/api/v1/auth/logout` | Выход |
| POST | `/api/v1/auth/forgot-password` | Сброс пароля |

#### Telegram-аккаунты

| Метод | Эндпоинт | Описание |
|-------|----------|----------|
| POST | `/api/v1/telegram/connect` | Инициация подключения |
| POST | `/api/v1/telegram/verify` | Подтверждение кодом |
| GET | `/api/v1/telegram/accounts` | Список аккаунтов |
| GET | `/api/v1/telegram/accounts/:id` | Детали аккаунта |
| DELETE | `/api/v1/telegram/accounts/:id` | Отключение аккаунта |

#### Источники

| Метод | Эндпоинт | Описание |
|-------|----------|----------|
| GET | `/api/v1/sources` | Список источников с фильтрацией |
| POST | `/api/v1/sources` | Добавление источника |
| GET | `/api/v1/sources/search` | Поиск каналов через TGStat |
| GET | `/api/v1/sources/:id` | Детали источника |
| PATCH | `/api/v1/sources/:id` | Обновление источника |
| DELETE | `/api/v1/sources/:id` | Удаление источника |
| POST | `/api/v1/sources/import` | Импорт из CSV |

#### Правила

| Метод | Эндпоинт | Описание |
|-------|----------|----------|
| GET | `/api/v1/rules` | Список правил |
| POST | `/api/v1/rules` | Создание правила |
| GET | `/api/v1/rules/templates` | Шаблоны промтов |
| GET | `/api/v1/rules/:id` | Детали правила |
| PATCH | `/api/v1/rules/:id` | Обновление правила |
| DELETE | `/api/v1/rules/:id` | Удаление правила |
| POST | `/api/v1/rules/:id/test` | Тестирование на исторических данных |

#### Лиды

| Метод | Эндпоинт | Описание |
|-------|----------|----------|
| GET | `/api/v1/leads` | Список лидов с пагинацией и фильтрами |
| GET | `/api/v1/leads/:id` | Детали лида |
| PATCH | `/api/v1/leads/:id` | Обновление статуса лида |
| POST | `/api/v1/leads/:id/comments` | Добавление комментария |
| POST | `/api/v1/leads/:id/assign` | Назначение на пользователя |
| GET | `/api/v1/leads/export` | Экспорт в CSV |

#### Аналитика

| Метод | Эндпоинт | Описание |
|-------|----------|----------|
| GET | `/api/v1/analytics/dashboard` | Данные для dashboard |
| GET | `/api/v1/analytics/leads-over-time` | График лидов по времени |
| GET | `/api/v1/analytics/sources-ranking` | Рейтинг источников |
| GET | `/api/v1/analytics/rules-stats` | Статистика по правилам |

#### Биллинг

| Метод | Эндпоинт | Описание |
|-------|----------|----------|
| GET | `/api/v1/billing/subscription` | Текущая подписка |
| GET | `/api/v1/billing/plans` | Доступные планы |
| POST | `/api/v1/billing/subscribe` | Оформление подписки |
| POST | `/api/v1/billing/cancel` | Отмена подписки |
| GET | `/api/v1/billing/invoices` | История платежей |

---

## 8. Требования к интерфейсу

### 8.1. Общие принципы

- Responsive design: desktop (1280px+), tablet (768px-1279px), mobile (320px-767px)
- Тёмная и светлая темы
- Минималистичный дизайн с акцентом на контент
- Консистентная дизайн-система (компоненты, типографика, цвета)
- Accessibility: WCAG 2.1 AA compliance

### 8.2. Ключевые экраны

#### Dashboard
- Обзор активности за выбранный период
- Последние 10 лидов
- Ключевые метрики: новые лиды, обработанные, конверсия
- Быстрые действия

#### Лента лидов
- Список найденных сообщений с бесконечным скроллом
- Фильтры: статус, источник, правило, дата, score
- Карточка лида с preview сообщения
- Bulk-действия

#### Управление источниками
- Grid/list view каналов
- Поиск и добавление через TGStat
- Статистика по каждому каналу
- Группировка по папкам/тегам

#### Редактор правил
- Форма создания/редактирования
- Textarea для промта с подсветкой переменных
- Preview результата на тестовых сообщениях
- История изменений

#### Настройки Telegram
- Список подключённых аккаунтов
- Статус и last seen
- Кнопка переподключения
- QR-код для авторизации

#### Аналитика
- Интерактивные графики (Recharts)
- Выбор периода
- Экспорт в PDF/CSV

#### Настройки аккаунта
- Профиль и безопасность
- Управление командой
- Настройки уведомлений
- Биллинг и подписка

---

## 9. Технологический стек

### 9.1. Frontend

| Компонент | Технология |
|-----------|------------|
| Framework | Next.js 14+ (App Router) |
| Styling | Tailwind CSS |
| UI Kit | shadcn/ui |
| State Management | TanStack Query + Zustand |
| Forms | React Hook Form + Zod |
| Charts | Recharts |
| Date/Time | date-fns |

### 9.2. Backend

| Компонент | Технология |
|-----------|------------|
| API Server | Python FastAPI или Node.js NestJS |
| Telegram Connector | Python + Telethon |
| Message Queue | Redis Streams или RabbitMQ |
| Task Queue | Celery (Python) или BullMQ (Node.js) |
| ORM | SQLAlchemy (Python) или Prisma (Node.js) |
| Validation | Pydantic / Zod |

### 9.3. Infrastructure

| Компонент | Технология |
|-----------|------------|
| Database | PostgreSQL 15+ |
| Cache | Redis 7+ |
| Search | Meilisearch (для поиска по лидам) |
| Container | Docker |
| Orchestration | Kubernetes |
| CI/CD | GitHub Actions |
| Monitoring | Prometheus + Grafana |
| Logging | Loki или ELK Stack |
| Secrets | HashiCorp Vault или AWS Secrets Manager |

### 9.4. External Services

| Сервис | Назначение |
|--------|------------|
| OpenAI API / Anthropic | LLM-анализ |
| TGStat API | Поиск каналов |
| Stripe / ЮKassa | Платежи |
| SendGrid / SES | Email |
| Sentry | Error tracking |
| Cloudflare | CDN + DDoS protection |

---

## 10. План разработки

### 10.1. Этап 1: MVP (8-10 недель)

**Цель:** Запустить минимально работающий продукт для первых пользователей

| Неделя | Задачи |
|--------|--------|
| 1-2 | Базовая инфраструктура: репозиторий, CI/CD, dev-окружение |
| 2-3 | Аутентификация (email + password), базовый UI |
| 3-5 | Telegram Connector: подключение аккаунта, получение сообщений |
| 5-6 | Ручное добавление каналов, хранение сообщений |
| 6-7 | LLM-интеграция: одно правило, анализ сообщений |
| 7-8 | Лента лидов, базовые фильтры |
| 8-9 | Уведомления в Telegram-бот |
| 9-10 | Dashboard, тестирование, bugfix |

**Deliverables MVP:**
- Базовая аутентификация (email + password)
- Подключение одного Telegram-аккаунта
- Ручное добавление каналов
- Одно правило мониторинга с LLM-анализом
- Лента лидов с базовыми фильтрами
- Уведомления в Telegram-бот
- Базовый dashboard

### 10.2. Этап 2: Расширение функций (6-8 недель)

| Неделя | Задачи |
|--------|--------|
| 1-2 | Интеграция TGStat API для поиска каналов |
| 2-3 | Множественные правила мониторинга |
| 3-4 | Шаблоны промтов, тестирование правил |
| 4-5 | Email-уведомления и дайджесты |
| 5-6 | Аналитика и отчёты |
| 6-7 | OAuth авторизация (Google, GitHub) |
| 7-8 | Улучшения UX, onboarding flow |

### 10.3. Этап 3: Монетизация (4-6 недель)

| Неделя | Задачи |
|--------|--------|
| 1-2 | Биллинг и подписки (Stripe интеграция) |
| 2-3 | Тарифные планы с лимитами |
| 3-4 | Trial-период, upgrade flow |
| 4-5 | Landing page |
| 5-6 | ЮKassa для РФ (опционально) |

### 10.4. Этап 4: Масштабирование (6-8 недель)

| Неделя | Задачи |
|--------|--------|
| 1-2 | Команды и роли |
| 2-3 | Множественные Telegram-аккаунты |
| 3-4 | Webhook-интеграции (CRM) |
| 4-5 | Публичный API для разработчиков |
| 5-6 | Enterprise-фичи: SSO, audit log |
| 6-8 | Оптимизация производительности, SLA |

---

## 11. Риски и митигации

| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| **Блокировка Telegram-аккаунта** | Средняя | Высокое | Rate limiting, ротация аккаунтов, использование proxy, чёткие ToS для пользователей о рисках |
| **Высокие затраты на LLM** | Высокая | Среднее | Предфильтрация по ключевикам, batching запросов, использование дешёвых моделей (GPT-4o-mini), кэширование похожих запросов |
| **Изменение TGStat API** | Низкая | Среднее | Абстракция интеграции, кэширование данных о каналах, альтернативные источники |
| **Низкое качество LLM-анализа** | Средняя | Высокое | Итеративное улучшение промтов, feedback loop от пользователей, A/B тесты промтов, возможность fine-tuning |
| **Утечка session-данных** | Низкая | Критическое | HSM/Vault для ключей, шифрование at rest, аудит доступа, принцип минимальных привилегий |
| **Конкуренция** | Средняя | Среднее | Фокус на UX и качестве анализа, быстрая итерация по feedback, нишевые кейсы |
| **Юридические риски (Telegram ToS)** | Средняя | Высокое | Консультация с юристами, disclaimers, Terms of Service для пользователей |

---

## 12. Приложения

### 12.1. Пример промта для LLM-анализа (Sales)

**Системный промт:**

```
Ты — ассистент по анализу сообщений для выявления потенциальных клиентов.

Контекст компании: Мы продаём платформу для тестирования и оценки сотрудников (assessment platform). Наши клиенты — HR-департаменты и руководители, которые нанимают персонал.

Твоя задача: Проанализировать сообщение из Telegram-канала и определить, есть ли в нём признаки интереса к решениям для оценки персонала.

Признаки релевантности:
- Упоминание найма сотрудников или расширения команды
- Проблемы с качеством найма или текучкой
- Интерес к оценке навыков кандидатов
- Упоминание тестирования при найме
- HR-автоматизация и оптимизация процессов

Верни JSON в формате:
{
  "relevant": true/false,
  "score": 0-100,
  "reasoning": "Краткое объяснение оценки",
  "entities": {
    "company": "Название компании, если упомянуто",
    "contact": "Контакт, если указан",
    "hiring_scale": "small/medium/large, если понятно"
  }
}
```

**Пример сообщения:**

> Коллеги, мы в поиске 5 Python-разработчиков уровня middle+. Задолбались собеседовать по 20 человек на позицию, а потом они уходят через 3 месяца. Может, кто знает нормальные тесты для оценки?

**Ожидаемый ответ:**

```json
{
  "relevant": true,
  "score": 92,
  "reasoning": "Явная боль с наймом разработчиков, упоминание проблемы текучки, прямой запрос на тесты для оценки — идеальный лид",
  "entities": {
    "company": null,
    "contact": null,
    "hiring_scale": "medium"
  }
}
```

### 12.2. Пример промта для LLM-анализа (HR/Recruiting)

**Системный промт:**

```
Ты — ассистент рекрутера в IT-компании.

Профиль поиска:
- Python-разработчики уровня Middle+
- Локация: Москва или удалёнка
- Готовность к full-time

Твоя задача: Определить, является ли автор сообщения потенциальным кандидатом.

Признаки релевантности:
- Явное или неявное упоминание поиска работы
- Релевантный технический опыт
- Совместимые условия (локация, формат)

Верни JSON:
{
  "relevant": true/false,
  "score": 0-100,
  "reasoning": "Объяснение",
  "candidate_info": {
    "skills": ["список навыков"],
    "experience_years": null или число,
    "location": "локация",
    "looking_for": "что ищет"
  }
}
```

### 12.3. Тарифные планы

| Параметр | Free | Pro | Enterprise |
|----------|------|-----|------------|
| **Цена/месяц** | 0 ₽ | 2 990 ₽ | Индивидуально |
| **Каналов** | 10 | 200 | Без лимита |
| **Правил** | 1 | 10 | Без лимита |
| **Сообщений/день** | 500 | 10 000 | 100 000+ |
| **TG-аккаунтов** | 1 | 3 | 10+ |
| **Пользователей** | 1 | 5 | Без лимита |
| **TGStat поиск** | — | ✓ | ✓ |
| **Webhook** | — | ✓ | ✓ |
| **API доступ** | — | — | ✓ |
| **SSO** | — | — | ✓ |
| **SLA** | — | — | 99.9% |
| **Поддержка** | Community | Email | Выделенный менеджер |

### 12.4. Глоссарий

| Термин | Определение |
|--------|-------------|
| **Tenant** | Организация-клиент в мультитенантной архитектуре |
| **Source** | Telegram-канал или чат, подключённый к мониторингу |
| **Rule** | Правило мониторинга с промтом для LLM |
| **Lead** | Найденное релевантное сообщение |
| **MTProto** | Протокол Telegram для работы от имени пользователя |
| **Userbot** | Автоматизация Telegram через пользовательский аккаунт |
| **TGStat** | Сервис аналитики Telegram-каналов |
| **Confidence Score** | Оценка уверенности LLM в релевантности (0-100) |

---

## История изменений

| Версия | Дата | Автор | Изменения |
|--------|------|-------|-----------|
| 1.0 | Декабрь 2025 | — | Первоначальная версия |

---

*Документ подготовлен для проекта Telegram Lead Monitor*
