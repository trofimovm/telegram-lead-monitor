# CLAUDE.md - –°—Ç–∞—Ç—É—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø–ª–∞–Ω

**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 10 –¥–µ–∫–∞–±—Ä—è 2025, 16:00
**–¢–µ–∫—É—â–∏–π —ç—Ç–∞–ø:** ‚úÖ **MVP –ó–ê–í–ï–†–®–ï–ù + –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã**
**Docker Status:** ‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
**–ü—Ä–æ–≥—Ä–µ—Å—Å MVP:** 9/9 —ç—Ç–∞–ø–æ–≤ (100%)
**–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –∏ –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏ –ª–∏–¥–æ–≤ (—Å–º. —Ä–∞–∑–¥–µ–ª "üêõ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ 10 –¥–µ–∫–∞–±—Ä—è 2025")

---

## üìã –û –¥–æ–∫—É–º–µ–Ω—Ç–µ

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Telegram Lead Monitor –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç:
- –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –∏ –∫–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Docker –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- –ü–ª–∞–Ω –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è

---

## üéØ –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

**Telegram Lead Monitor** - SaaS-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Telegram-–∫–∞–Ω–∞–ª–æ–≤ —Å LLM-–∞–Ω–∞–ª–∏–∑–æ–º —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –ª–∏–¥–æ–≤.

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

**Backend:**
- FastAPI 0.109.2 (Python 3.10+)
- PostgreSQL 15 (–æ—Å–Ω–æ–≤–Ω–∞—è –ë–î)
- Redis 7 (–∫—ç—à –∏ –æ—á–µ—Ä–µ–¥–∏)
- Telethon 1.34.0 (Telegram MTProto)
- SQLAlchemy 2.0.27 + Alembic 1.13.1
- APScheduler 3.10.4 (—Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏)
- Cryptography 42.0.2 (Fernet –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Å—Å–∏–π)
- Python-Jose (JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)
- httpx 0.25.2 (LLM API –∫–ª–∏–µ–Ω—Ç, downgraded –∏–∑-–∑–∞ python-telegram-bot)
- python-telegram-bot 20.7 (Telegram Bot API –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)

**Frontend:**
- Next.js 14+ —Å App Router
- TypeScript
- Tailwind CSS 3.3+ —Å custom design system
- Axios (HTTP –∫–ª–∏–µ–Ω—Ç —Å auto-refresh —Ç–æ–∫–µ–Ω–æ–≤)
- React Context (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º)

**LLM:**
- llm.codenrock.com (LiteLLM Proxy)
- –ú–æ–¥–µ–ª—å: gpt-5-mini (400K context, $0.00075/$0.003 per 1K tokens)
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã: gpt-4o-mini, gpt-4o, claude-sonnet-4, gemini-2.5-pro
- –°–º. [LLM_MODELS.md](./LLM_MODELS.md) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π

**Docker:**
- 5 —Å–µ—Ä–≤–∏—Å–æ–≤: postgres, redis, backend, worker, frontend
- Multi-stage builds –¥–ª—è development –∏ production
- Volume persistence –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
- Health checks –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

---

## üöÄ Docker –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ó–∞–ø—É—â–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

```bash
CONTAINER                    PORT MAPPING           STATUS
telegram-monitor-postgres    5433:5432             healthy
telegram-monitor-redis       6380:6379             healthy
telegram-monitor-backend     8001:8000             healthy
telegram-monitor-worker      (internal)            running
telegram-monitor-frontend    3002:3000             running
```

### –ü–æ—Ä—Ç—ã (–∏–∑–º–µ–Ω–µ–Ω—ã –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)

**–ü—Ä–∏—á–∏–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—Ç–æ–≤:** –ù–∞ –º–∞—à–∏–Ω–µ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥—Ä—É–≥–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (testsys), –∫–æ—Ç–æ—Ä–æ–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ—Ä—Ç—ã.

| –°–µ—Ä–≤–∏—Å     | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç | –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ø–æ—Ä—Ç | –ü—Ä–∏—á–∏–Ω–∞        |
|------------|------------------|-------------------|----------------|
| PostgreSQL | 5432             | **5433**          | –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å testsys-postgres |
| Redis      | 6379             | **6380**          | –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å testsys-redis |
| Backend    | 8000             | **8001**          | –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å testsys-backend |
| Frontend   | 3000             | **3002**          | –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å testsys-frontend |

### –î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é

- **Frontend**: http://localhost:3002
- **Backend API**: http://localhost:8001
- **API Docs (Swagger)**: http://localhost:8001/docs
- **API ReDoc**: http://localhost:8001/redoc
- **Health Check**: http://localhost:8001/api/health

### Docker —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f backend
docker-compose logs -f frontend
docker-compose logs -f worker

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose restart backend

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
docker-compose up -d --build
```

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ Docker

### 1. docker-entrypoint.sh - Permission Denied
**–ü—Ä–æ–±–ª–µ–º–∞:** –§–∞–π–ª –Ω–µ –∏–º–µ–ª –ø—Ä–∞–≤ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –±—ã–ª –∏—Å–∫–ª—é—á–µ–Ω –∏–∑ .dockerignore
**–†–µ—à–µ–Ω–∏–µ:**
- –£–¥–∞–ª–µ–Ω –∏–∑ `backend/.dockerignore`
- –î–æ–±–∞–≤–ª–µ–Ω `chmod 755` –≤ Dockerfile (–±—ã–ª–æ `chmod +x` —á—Ç–æ –¥–∞–≤–∞–ª–æ —Ç–æ–ª—å–∫–æ execute –±–µ–∑ read)

### 2. Frontend npm ci failed
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç package-lock.json, –Ω–æ Dockerfile –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `npm ci`
**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ `npm install --legacy-peer-deps` –≤ `frontend/Dockerfile`

### 3. Port conflicts
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Ä—Ç—ã 5432, 6379, 8000, 3000 –∑–∞–Ω—è—Ç—ã –¥—Ä—É–≥–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º (testsys)
**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–µ–Ω—ã –ø–æ—Ä—Ç—ã –≤ docker-compose.yml –∏ .env —Ñ–∞–π–ª–∞—Ö (—Å–º. —Ç–∞–±–ª–∏—Ü—É –≤—ã—à–µ)

### 4. ModuleNotFoundError: app.models.base
**–ü—Ä–æ–±–ª–µ–º–∞:** `backend/app/models/notification.py` –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–æ–¥—É–ª—å
**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–µ–Ω –∏–º–ø–æ—Ä—Ç —Å `from app.models.base import Base` –Ω–∞ `from app.database import Base`

### 5. SQLAlchemy: Attribute 'metadata' is reserved
**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–¥–µ–ª—å Notification –∏–º–µ–ª–∞ –ø–æ–ª–µ `metadata` (–∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–º—è)
**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ –≤ `extra_data` –≤ `backend/app/models/notification.py`

### 6. ModuleNotFoundError: app.api.dependencies
**–ü—Ä–æ–±–ª–µ–º–∞:** –§–∞–π–ª—ã `notifications.py` –∏ `users.py` –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–æ–¥—É–ª—å
**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–µ–Ω –∏–º–ø–æ—Ä—Ç —Å `from app.api.dependencies` –Ω–∞ `from app.api.deps`

### 7. Frontend read-only filesystem error
**–ü—Ä–æ–±–ª–µ–º–∞:** –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `/app` –±—ã–ª–∞ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∫–∞–∫ read-only, –Ω–æ Next.js –Ω—É–∂–Ω–∞ –∑–∞–ø–∏—Å—å –≤ `.next`
**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–µ–Ω —Ñ–ª–∞–≥ `:ro` –∏–∑ volume mount –≤ docker-compose.yml

### 8. Dependency conflict: python-telegram-bot vs httpx
**–ü—Ä–æ–±–ª–µ–º–∞:** `python-telegram-bot==20.7` —Ç—Ä–µ–±—É–µ—Ç `httpx~=0.25.2`, –Ω–æ –≤ –ø—Ä–æ–µ–∫—Ç–µ –±—ã–ª `httpx==0.26.0`
**–†–µ—à–µ–Ω–∏–µ:** Downgrade httpx —Å 0.26.0 –¥–æ 0.25.2 –≤ `requirements.txt`

### 9. Import error: SessionLocal –Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è
**–ü—Ä–æ–±–ª–µ–º–∞:** `telegram_bot_service.py` –ø—ã—Ç–∞–ª—Å—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `SessionLocal` –∏–∑ `app.database`, –Ω–æ —Ç–∞–º —Ç–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏—è `get_session_local()`
**–†–µ—à–µ–Ω–∏–µ:**
- –ò–∑–º–µ–Ω–µ–Ω –∏–º–ø–æ—Ä—Ç —Å `from app.database import SessionLocal` –Ω–∞ `from app.database import get_session_local`
- –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `SessionLocal = get_session_local()` –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Å–µ—Å—Å–∏–∏

### 10. Telegram Markdown parsing error
**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ—Ç –ø–∞–¥–∞–ª —Å –æ—à–∏–±–∫–æ–π "Can't parse entities" –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ backticks –≤ Markdown
**–†–µ—à–µ–Ω–∏–µ:** –£–±—Ä–∞–Ω—ã backticks –∏–∑ Chat ID –≤ –∫–æ–º–∞–Ω–¥–µ `/start`, —É–±—Ä–∞–Ω `parse_mode="Markdown"`

### 11. Logger –Ω–µ –≤—ã–≤–æ–¥–∏–ª –ª–æ–≥–∏ –∏–∑ lifespan
**–ü—Ä–æ–±–ª–µ–º–∞:** –õ–æ–≥–∏ –∏–∑ `start_bot()` –Ω–µ –ø–æ—è–≤–ª—è–ª–∏—Å—å –≤ `docker logs`
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã `print(..., flush=True)` –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞—Ä—è–¥—É —Å logger

---

## üêõ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ 10 –¥–µ–∫–∞–±—Ä—è 2025

### –ö–æ–Ω—Ç–µ–∫—Å—Ç

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±–Ω–∞—Ä—É–∂–∏–ª –¥–≤–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ production:
1. **–î—É–±–ª–∏–∫–∞—Ç—ã –ª–∏–¥–æ–≤**: –î–≤–∞ –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–∏—Ö –ª–∏–¥–∞ –ø—Ä–æ Minecraft, –æ–±–∞ —Å–æ–∑–¥–∞–Ω—ã 09.12.2025 23:14 —Å —Ä–∞–∑–Ω—ã–º–∏ –æ—Ü–µ–Ω–∫–∞–º–∏ (90% –∏ 95%)
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**: –ù–æ–≤—ã–µ –ª–∏–¥—ã –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram, —Ö–æ—Ç—è –±–æ—Ç –±—ã–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### –ü—Ä–æ–±–ª–µ–º–∞ #1: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ë–ê–ì - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–§–∞–π–ª:** `backend/app/services/rule_processor_v2.py`
**–°—Ç—Ä–æ–∫–∞:** 395

**–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ (–ë–ê–ì):**
```python
# –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤–ª–∞–¥–µ–ª—å—Ü–∞ tenant)
user = db.query(User).filter(User.id == tenant_id).first()  # ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ö–æ–¥ –∏—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ `User.id == tenant_id`
- –ù–æ `tenant_id` - —ç—Ç–æ UUID **—Ç–µ–Ω–∞–Ω—Ç–∞**, –∞ –Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!
- –†–µ–∑—É–ª—å—Ç–∞—Ç: `user` –≤—Å–µ–≥–¥–∞ `None`, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è **–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è**
- –û—à–∏–±–∫–∞ **—Ç–∏—Ö–∞—è** (silent failure) - —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç –ø—Ä–æ–±–ª–µ–º—É

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥:**
```python
# –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤–ª–∞–¥–µ–ª—å—Ü–∞ tenant)
user = db.query(User).filter(User.tenant_id == tenant_id).first()  # ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
```python
# –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º –ª–∏–¥–µ
if user:
    try:
        await notification_service.create_new_lead_notification(
            db=db,
            lead=lead,
            user=user
        )
        logger.info(f"Notification sent for lead {lead.id} to user {user.id}")  # ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ
    except Exception as e:
        logger.error(f"Failed to create notification for lead {lead.id}: {str(e)}", exc_info=True)
else:
    logger.warning(f"No user found for tenant {tenant_id}, notification not sent for lead {lead.id}")  # ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ
```

**Commit:** `backend/app/services/rule_processor_v2.py` (line 395, 405-409)

---

### –ü—Ä–æ–±–ª–µ–º–∞ #2: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ UNIQUE constraint –≤ —Ç–∞–±–ª–∏—Ü–µ leads

**–§–∞–π–ª:** `backend/app/models/lead.py`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ú–æ–¥–µ–ª—å `Lead` –ù–ï –∏–º–µ–ª–∞ database-level UNIQUE constraint –Ω–∞ `(tenant_id, global_message_id, rule_id)`
- –¢–æ–ª—å–∫–æ application-level –ø—Ä–æ–≤–µ—Ä–∫–∞ (—Å—Ç—Ä–æ–∫–∏ 205-209 –≤ `rule_processor_v2.py`)
- **Race condition**: –î–≤–∞ worker'–∞ –º–æ–≥—É—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ —Å–æ–∑–¥–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã
- Worker –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É - –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –∫–æ–ª–ª–∏–∑–∏–π

**–ö–∞–∫ –º–æ–≥–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã:**

**–í–∞—Ä–∏–∞–Ω—Ç A (–Ω–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—ã–π):** –î–≤–∞ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª–∞
- –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å 2 –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ Minecraft
- –û–±–∞ –ø—Ä–∞–≤–∏–ª–∞ —Å–æ–≤–ø–∞–ª–∏ —Å –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ–º
- LLM –æ—Ü–µ–Ω–∏–ª –∫–∞–∂–¥–æ–µ –ø—Ä–∞–≤–∏–ª–æ –ø–æ-—Å–≤–æ–µ–º—É ‚Üí —Ä–∞–∑–Ω—ã–µ scores (90% vs 95%)
- –†–µ–∑—É–ª—å—Ç–∞—Ç: 2 –ª–∏–¥–∞ –æ—Ç –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–æ –æ—Ç **—Ä–∞–∑–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª** ‚Üê —ç—Ç–æ **–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ** –ø–æ–≤–µ–¥–µ–Ω–∏–µ!

**–í–∞—Ä–∏–∞–Ω—Ç B (–±–∞–≥):** Race condition –æ–¥–Ω–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞
- –î–≤–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ worker'–∞ –∑–∞–ø—É—Å—Ç–∏–ª–∏—Å—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –û–±–∞ –ø—Ä–æ–≤–µ—Ä–∏–ª–∏ `existing_lead` ‚Üí –æ–±–∞ –ø–æ–ª—É—á–∏–ª–∏ `None`
- –û–±–∞ —Å–æ–∑–¥–∞–ª–∏ –ª–∏–¥ –î–û —Ç–æ–≥–æ –∫–∞–∫ –±—ã–ª –æ–±–Ω–æ–≤–ª–µ–Ω progress
- –ë–∞–∑–∞ **—Ä–∞–∑—Ä–µ—à–∏–ª–∞** –≤—Å—Ç–∞–≤–∫—É (–Ω–µ—Ç constraint)
- –†–µ–∑—É–ª—å—Ç–∞—Ç: 2 –¥—É–±–ª–∏–∫–∞—Ç–∞ –æ—Ç **–æ–¥–Ω–æ–≥–æ** –ø—Ä–∞–≤–∏–ª–∞ ‚Üê —ç—Ç–æ **–ë–ê–ì**!

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω UNIQUE constraint –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î

**–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥:**
```python
class Lead(Base):
    __tablename__ = "leads"

    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    tenant_id = Column(UUID(as_uuid=True), ForeignKey("tenants.id"), nullable=False)
    global_message_id = Column(UUID(as_uuid=True), ForeignKey("global_messages.id"), nullable=False)
    rule_id = Column(UUID(as_uuid=True), ForeignKey("rules.id"), nullable=False)
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è ...

    # –ù–ï–¢ __table_args__ ‚ùå
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥:**
```python
from sqlalchemy import UniqueConstraint, Index  # ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ

class Lead(Base):
    __tablename__ = "leads"

    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    tenant_id = Column(UUID(as_uuid=True), ForeignKey("tenants.id", ondelete="CASCADE"), nullable=False)
    global_message_id = Column(UUID(as_uuid=True), ForeignKey("global_messages.id", ondelete="CASCADE"), nullable=False)
    rule_id = Column(UUID(as_uuid=True), ForeignKey("rules.id", ondelete="CASCADE"), nullable=False)
    score = Column(Numeric(3, 2), nullable=False)  # 0.00 to 1.00
    reasoning = Column(Text, nullable=True)  # LLM explanation
    extracted_entities = Column(JSON, nullable=True)  # Structured data from LLM
    status = Column(String(50), default="new", nullable=False)
    assignee_id = Column(UUID(as_uuid=True), ForeignKey("users.id", ondelete="SET NULL"), nullable=True)
    created_at = Column(DateTime, default=datetime.utcnow, nullable=False, index=True)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow, nullable=False)

    # ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û: Table constraints –∏ performance indexes
    __table_args__ = (
        UniqueConstraint('tenant_id', 'global_message_id', 'rule_id',
                        name='uq_lead_tenant_message_rule'),
        Index('ix_leads_tenant_status', 'tenant_id', 'status'),
        Index('ix_leads_score', 'score'),
    )
```

**Commit:** `backend/app/models/lead.py`

---

### –ü—Ä–æ–±–ª–µ–º–∞ #3: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è UNIQUE constraint

**–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª:** `backend/alembic/versions/f9a4b3c5d8e7_add_unique_constraint_to_leads.py`

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**
```python
"""add unique constraint to leads table

Revision ID: f9a4b3c5d8e7
Revises: 6ebfcdb89d6a
Create Date: 2025-12-10 02:30:00.000000

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = 'f9a4b3c5d8e7'
down_revision: Union[str, None] = '6ebfcdb89d6a'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # Create unique constraint to prevent duplicate leads from same message and rule
    op.create_unique_constraint(
        'uq_lead_tenant_message_rule',
        'leads',
        ['tenant_id', 'global_message_id', 'rule_id']
    )

    # Create performance indexes
    op.create_index('ix_leads_tenant_status', 'leads', ['tenant_id', 'status'])
    op.create_index('ix_leads_score', 'leads', ['score'])


def downgrade() -> None:
    # Drop indexes
    op.drop_index('ix_leads_score', table_name='leads')
    op.drop_index('ix_leads_tenant_status', table_name='leads')

    # Drop unique constraint
    op.drop_constraint('uq_lead_tenant_message_rule', 'leads', type_='unique')
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
```bash
# –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ Docker
docker exec telegram-monitor-backend alembic upgrade head
```

**Commit:** Migration file created

---

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

**‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
1. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –ø–æ–ª—É—á–∞—Ç—å Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –ª–∏–¥–∞—Ö
2. **Race condition –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω** - database-level constraint –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã
3. **–õ—É—á—à–µ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - —É—Å–ø–µ—Ö/–ø—Ä–æ–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —á–µ—Ç–∫–æ –≤–∏–¥–Ω—ã –≤ –ª–æ–≥–∞—Ö
4. **Performance indexes** - –±—ã—Å—Ç—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ —Å—Ç–∞—Ç—É—Å—É –∏ score

**‚ö†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –≤ UI:
   - Telegram Bot –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω (chat_id —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
   - Toggle "Enable Telegram Notifications" –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ON
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
2. **–ü—Ä–∏—á–∏–Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ Minecraft:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ë–î: –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ª–∏ `rule_id` —É –¥–≤—É—Ö –ª–∏–¥–æ–≤?
   - –ï—Å–ª–∏ —Ä–∞–∑–Ω—ã–µ rule_id ‚Üí —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–¥–≤–∞ –ø—Ä–∞–≤–∏–ª–∞ —Å—Ä–∞–±–æ—Ç–∞–ª–∏)
   - –ï—Å–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ rule_id ‚Üí race condition (—Ç–µ–ø–µ—Ä—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω)

**üìù –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ª–∏–¥–∞
docker logs -f telegram-monitor-backend | grep -i "notification\|telegram"

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# "Notification sent for lead XXX to user YYY"
# "Sent Telegram notification to chat_id ZZZ"

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å constraint –≤ –ë–î
docker exec -it telegram-monitor-postgres psql -U telegram_monitor -d telegram_monitor
\d leads
# –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å: "uq_lead_tenant_message_rule" UNIQUE CONSTRAINT

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã Minecraft
SELECT
    l.id,
    l.rule_id,
    l.global_message_id,
    l.score,
    l.reasoning,
    r.name as rule_name,
    l.created_at
FROM leads l
JOIN rules r ON l.rule_id = r.id
WHERE l.reasoning LIKE '%Minecraft%'
ORDER BY l.created_at DESC
LIMIT 5;
```

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:** 10 –¥–µ–∫–∞–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω, –º–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
**Pending:** –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏, –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ production

---

## ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —ç—Ç–∞–ø—ã (–í—Å–µ 9 —Å—Ç–∞–¥–∏–π)

### Stage 1-4: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ + Auth + Telegram ‚úÖ

–°–º. –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π. –ö—Ä–∞—Ç–∫–æ:
- ‚úÖ FastAPI + PostgreSQL + Redis setup
- ‚úÖ SQLAlchemy –º–æ–¥–µ–ª–∏ (User, Tenant, TelegramAccount, Source, Message, Rule, Lead, Notification)
- ‚úÖ JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å refresh tokens
- ‚úÖ Telegram integration (Telethon)
- ‚úÖ Message collection worker (APScheduler)
- ‚úÖ Frontend (Next.js 14 App Router)
- ‚úÖ Auth UI (login/register)
- ‚úÖ Telegram Accounts + Sources management UI

### Stage 5: LLM Integration & Rules Engine ‚úÖ

**LLM Configuration:**
- ‚úÖ LLM Service (`app/services/llm_service.py`) - OpenAI-compatible API
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å llm.codenrock.com (LiteLLM Proxy)
- ‚úÖ –ú–æ–¥–µ–ª—å: **gpt-5-mini** (—Å–∞–º–∞—è —ç–∫–æ–Ω–æ–º–∏—á–Ω–∞—è –∏ –±—ã—Å—Ç—Ä–∞—è)
- ‚úÖ API Key: `sk-litellm-5d72bc9cb76846620c011e7708fcf4c9`
- ‚úÖ –ú–µ—Ç–æ–¥—ã:
  - `analyze_message_with_rule()` - –∞–Ω–∞–ª–∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∞–≤–∏–ª—É
  - `extract_lead_info()` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ª–∏–¥–µ
  - `_call_llm()` - –±–∞–∑–æ–≤—ã–π –≤—ã–∑–æ–≤ LLM API
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, rate limiting, timeout (120s)

**Rules API:**
- ‚úÖ `app/api/v1/rules.py` - –ø–æ–ª–Ω—ã–π CRUD
- ‚úÖ Endpoints: create, list, get, update, delete
- ‚úÖ –°–≤—è–∑—å –ø—Ä–∞–≤–∏–ª —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ (many-to-many —á–µ—Ä–µ–∑ source_ids array)
- ‚úÖ Schemas: `app/schemas/rule.py`

**Rule Processor:**
- ‚úÖ `app/services/rule_processor.py`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –≤—Å–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏–¥–æ–≤ –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ (score >= threshold)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MessageCollectorWorker

**Leads API:**
- ‚úÖ `app/api/v1/leads.py`
- ‚úÖ Endpoints: list (—Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏), get, update status, delete
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: status, rule_id, source_id, date range, score
- ‚úÖ –°—Ç–∞—Ç—É—Å—ã: new ‚Üí contacted ‚Üí qualified ‚Üí won/lost
- ‚úÖ Export to CSV
- ‚úÖ Schemas: `app/schemas/lead.py`

**–§–∞–π–ª—ã:**
```
backend/app/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ llm_service.py          ‚úÖ LLM integration
‚îÇ   ‚îî‚îÄ‚îÄ rule_processor.py       ‚úÖ Message analysis & lead creation
‚îú‚îÄ‚îÄ api/v1/
‚îÇ   ‚îú‚îÄ‚îÄ rules.py                ‚úÖ Rules CRUD API
‚îÇ   ‚îî‚îÄ‚îÄ leads.py                ‚úÖ Leads management API
‚îî‚îÄ‚îÄ schemas/
    ‚îú‚îÄ‚îÄ rule.py                 ‚úÖ Rule schemas
    ‚îî‚îÄ‚îÄ lead.py                 ‚úÖ Lead schemas
```

### Stage 6: Frontend –¥–ª—è Rules & Leads ‚úÖ

**Rules Page:**
- ‚úÖ `app/dashboard/rules/page.tsx`
- ‚úÖ –°–ø–∏—Å–æ–∫ –ø—Ä–∞–≤–∏–ª —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª
- ‚úÖ –í—ã–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (multi-select)
- ‚úÖ LLM prompt editor
- ‚úÖ –ê–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª

**Leads Dashboard:**
- ‚úÖ `app/dashboard/leads/page.tsx`
- ‚úÖ –°–ø–∏—Å–æ–∫ –ª–∏–¥–æ–≤ —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
- ‚úÖ –§–∏–ª—å—Ç—Ä—ã: status, rule, source, date range, score
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ, score
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ª–∏–¥–∞
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "Open in Telegram"
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –ª–∏–¥–æ–≤
- ‚úÖ Export to CSV

**Lead Detail Modal:**
- ‚úÖ –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (source, date, author)
- ‚úÖ LLM –∞–Ω–∞–ª–∏–∑ (score, extracted info)
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
- ‚úÖ –ó–∞–º–µ—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Dashboard Updates:**
- ‚úÖ –†–µ–∞–ª—å–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- ‚úÖ –í–∏–¥–∂–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ª–∏–¥–æ–≤
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

**–§–∞–π–ª—ã:**
```
frontend/
‚îú‚îÄ‚îÄ lib/api/
‚îÇ   ‚îú‚îÄ‚îÄ rule-types.ts           ‚úÖ Rule TypeScript types
‚îÇ   ‚îú‚îÄ‚îÄ rules.ts                ‚úÖ Rules API client
‚îÇ   ‚îú‚îÄ‚îÄ lead-types.ts           ‚úÖ Lead TypeScript types
‚îÇ   ‚îî‚îÄ‚îÄ leads.ts                ‚úÖ Leads API client
‚îî‚îÄ‚îÄ app/dashboard/
    ‚îú‚îÄ‚îÄ rules/page.tsx          ‚úÖ Rules management UI
    ‚îî‚îÄ‚îÄ leads/page.tsx          ‚úÖ Leads dashboard UI
```

### Stage 7: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚úÖ

**Notification System:**
- ‚úÖ `app/services/notification_service.py`
- ‚úÖ Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (SMTP)
- ‚úÖ In-app notifications
- ‚úÖ **Telegram Bot —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** (NEW! ‚≠ê)
- ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä—ã:
  - –ù–æ–≤—ã–π –ª–∏–¥ —Å–æ–∑–¥–∞–Ω
  - –°—Ç–∞—Ç—É—Å –ª–∏–¥–∞ –∏–∑–º–µ–Ω–µ–Ω
  - –õ–∏–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Telegram Bot Integration:** ‚≠ê NEW!
- ‚úÖ `app/services/telegram_bot_service.py` - —Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–æ–º
- ‚úÖ Bot token: `8478336010:AAEk-fhKNUMl_dfVaRWC88zrlrMF7SGWTLQ`
- ‚úÖ Bot username: `@tg_lead_notify_bot`
- ‚úÖ Lifecycle management —á–µ—Ä–µ–∑ FastAPI lifespan (–∑–∞–ø—É—Å–∫/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–º–µ—Å—Ç–µ —Å backend)
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:
  - `/start` - –ø–æ–ª—É—á–∏—Ç—å Chat ID
  - `/verify CODE` - –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –∫–æ–¥—É
- ‚úÖ Verification flow:
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 6-–∑–Ω–∞—á–Ω–æ–≥–æ –∫–æ–¥–∞ (15 –º–∏–Ω—É—Ç TTL)
  - –•—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –≤ –ë–î (`telegram_verification_code`, `telegram_verification_expires`)
  - –ü—Ä–∏–≤—è–∑–∫–∞ Chat ID –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ—Å–ª–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–æ–≤—ã—Ö –ª–∏–¥–∞—Ö –≤ Telegram
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `notification_service.py`

**–í–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏:**
- –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ —Ç–æ–º –∂–µ –ø—Ä–æ—Ü–µ—Å—Å–µ —á—Ç–æ –∏ FastAPI backend (–Ω–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è long polling —á–µ—Ä–µ–∑ `python-telegram-bot`
- –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ `/start` –±–æ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Chat ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏:
  1. –í UI: –≤–≤–µ—Å—Ç–∏ Chat ID + –∫–æ–¥
  2. –í Telegram: `/verify CODE`
- –ü–æ–ª—è –≤ User model: `telegram_chat_id`, `telegram_bot_enabled`, `telegram_verification_code`, `telegram_verification_expires`

**Notification API:**
- ‚úÖ `app/api/v1/notifications.py`
- ‚úÖ Endpoints: list, mark as read, mark all as read, stats
- ‚úÖ Schemas: `app/schemas/notification.py`

**User API (Telegram endpoints):** ‚≠ê NEW!
- ‚úÖ `GET /api/v1/users/me/telegram-bot` - –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- ‚úÖ `POST /api/v1/users/me/telegram-bot/generate-code` - —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
- ‚úÖ `POST /api/v1/users/me/telegram-bot/verify` - –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å
- ‚úÖ `POST /api/v1/users/me/telegram-bot/disconnect` - –æ—Ç–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞

**Frontend:**
- ‚úÖ `app/dashboard/settings/page.tsx` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ `components/settings/TelegramBotConnection.tsx` - UI –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Telegram –±–æ—Ç–∞ ‚≠ê
- ‚úÖ Notification preferences: email, in-app, telegram toggles
- ‚úÖ Dark theme support –¥–ª—è –≤—Å–µ—Ö UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π –ø—Ä–æ `/verify` –∫–æ–º–∞–Ω–¥—É

**–§–∞–π–ª—ã:**
```
backend/app/
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ notification.py         ‚úÖ Notification model
‚îÇ   ‚îî‚îÄ‚îÄ user.py                 ‚úÖ +4 –ø–æ–ª—è –¥–ª—è Telegram
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ notification_service.py ‚úÖ Email, in-app, Telegram
‚îÇ   ‚îî‚îÄ‚îÄ telegram_bot_service.py ‚úÖ Telegram Bot service ‚≠ê NEW
‚îú‚îÄ‚îÄ api/v1/
‚îÇ   ‚îú‚îÄ‚îÄ notifications.py        ‚úÖ Notifications API
‚îÇ   ‚îî‚îÄ‚îÄ users.py                ‚úÖ +4 Telegram endpoints ‚≠ê
‚îî‚îÄ‚îÄ schemas/
    ‚îî‚îÄ‚îÄ notification.py         ‚úÖ +5 Telegram schemas ‚≠ê

frontend/
‚îú‚îÄ‚îÄ components/settings/
‚îÇ   ‚îî‚îÄ‚îÄ TelegramBotConnection.tsx ‚úÖ Telegram connection UI ‚≠ê NEW
‚îú‚îÄ‚îÄ lib/api/
‚îÇ   ‚îú‚îÄ‚îÄ notification-types.ts   ‚úÖ +5 Telegram types ‚≠ê
‚îÇ   ‚îî‚îÄ‚îÄ notifications.ts        ‚úÖ +4 Telegram methods ‚≠ê
‚îî‚îÄ‚îÄ app/dashboard/
    ‚îî‚îÄ‚îÄ settings/page.tsx       ‚úÖ Telegram section ‚≠ê
```

### Stage 8: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ ‚úÖ

**Analytics API:**
- ‚úÖ `app/api/v1/analytics.py`
- ‚úÖ Endpoints:
  - `/summary` - –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  - `/leads-time-series` - –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ä—è–¥ —Å–æ–∑–¥–∞–Ω–∏—è –ª–∏–¥–æ–≤
  - `/conversion-funnel` - –≤–æ—Ä–æ–Ω–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
  - `/source-performance` - –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
  - `/rule-performance` - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–∞–≤–∏–ª
  - `/activity-trends` - —Ç—Ä–µ–Ω–¥—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫
- ‚úÖ Schemas: `app/schemas/analytics.py`

**Frontend Analytics:**
- ‚úÖ `app/dashboard/analytics/page.tsx`
- ‚úÖ Summary cards (total leads, conversion rate, avg score)
- ‚úÖ Leads time series chart (line chart)
- ‚úÖ Conversion funnel visualization
- ‚úÖ Source performance (bar chart)
- ‚úÖ Rule performance metrics
- ‚úÖ Activity heatmap by hour

**Dashboard Integration:**
- ‚úÖ –†–µ–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- ‚úÖ Mini charts –∏ —Ç—Ä–µ–Ω–¥—ã
- ‚úÖ Quick stats widgets

**–§–∞–π–ª—ã:**
```
backend/app/
‚îú‚îÄ‚îÄ api/v1/
‚îÇ   ‚îî‚îÄ‚îÄ analytics.py            ‚úÖ Analytics API
‚îî‚îÄ‚îÄ schemas/
    ‚îî‚îÄ‚îÄ analytics.py            ‚úÖ Analytics schemas

frontend/
‚îú‚îÄ‚îÄ lib/api/
‚îÇ   ‚îú‚îÄ‚îÄ analytics-types.ts      ‚úÖ Analytics TypeScript types
‚îÇ   ‚îî‚îÄ‚îÄ analytics.ts            ‚úÖ Analytics API client
‚îú‚îÄ‚îÄ components/charts/          ‚úÖ Chart components
‚îÇ   ‚îú‚îÄ‚îÄ LeadsTimeSeriesChart.tsx
‚îÇ   ‚îú‚îÄ‚îÄ ConversionFunnelChart.tsx
‚îÇ   ‚îú‚îÄ‚îÄ SourcePerformanceChart.tsx
‚îÇ   ‚îî‚îÄ‚îÄ ActivityHeatmap.tsx
‚îî‚îÄ‚îÄ app/dashboard/
    ‚îî‚îÄ‚îÄ analytics/page.tsx      ‚úÖ Analytics page
```

### Stage 9: Testing & Documentation ‚úÖ

**Testing:**
- ‚úÖ Backend tests (`backend/tests/`)
  - `test_auth.py` - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ JWT
  - `test_leads.py` - leads API
  - `test_analytics.py` - analytics endpoints
- ‚úÖ Test setup: pytest, fixtures, test DB
- ‚úÖ Coverage: auth, core APIs

**Documentation:**
- ‚úÖ `README.md` - –æ—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `LLM_MODELS.md` - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ LLM –º–æ–¥–µ–ª–µ–π
- ‚úÖ `DOCKER.md` - Docker setup –∏ troubleshooting
- ‚úÖ `DEPLOYMENT.md` - deployment guide
- ‚úÖ `CLAUDE.md` (—ç—Ç–æ—Ç —Ñ–∞–π–ª) - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ API Docs: Swagger UI –Ω–∞ /docs, ReDoc –Ω–∞ /redoc
- ‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ README

**Docker Setup:**
- ‚úÖ Full Docker Compose setup
- ‚úÖ Multi-stage Dockerfiles (development + production)
- ‚úÖ Volume mounts –¥–ª—è hot reload
- ‚úÖ Health checks –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ Makefile —Å —É–¥–æ–±–Ω—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏

**–§–∞–π–ª—ã:**
```
backend/tests/
‚îú‚îÄ‚îÄ conftest.py                 ‚úÖ Test fixtures
‚îú‚îÄ‚îÄ test_auth.py                ‚úÖ Auth tests
‚îú‚îÄ‚îÄ test_leads.py               ‚úÖ Leads tests
‚îî‚îÄ‚îÄ test_analytics.py           ‚úÖ Analytics tests

./
‚îú‚îÄ‚îÄ README.md                   ‚úÖ Updated with all features
‚îú‚îÄ‚îÄ LLM_MODELS.md               ‚úÖ LLM documentation
‚îú‚îÄ‚îÄ DOCKER.md                   ‚úÖ Docker guide
‚îú‚îÄ‚îÄ DEPLOYMENT.md               ‚úÖ Deployment instructions
‚îú‚îÄ‚îÄ CLAUDE.md                   ‚úÖ This file
‚îú‚îÄ‚îÄ docker-compose.yml          ‚úÖ All services configured
‚îú‚îÄ‚îÄ backend/Dockerfile          ‚úÖ Multi-stage build
‚îî‚îÄ‚îÄ frontend/Dockerfile         ‚úÖ Multi-stage build
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –ú—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –í—Å–µ –º–æ–¥–µ–ª–∏ –∏–º–µ—é—Ç `tenant_id: UUID`
- FastAPI dependency `get_current_tenant()` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç tenant –∏–∑ JWT
- –í—Å–µ queries –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ `tenant_id`

**–ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
```python
# –ü—Ä–∏–º–µ—Ä –∏–∑ dependencies
async def get_current_tenant(current_user: User = Depends(get_current_active_user)) -> Tenant:
    return current_user.tenant

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ endpoint
@router.get("/sources")
async def list_sources(
    tenant: Tenant = Depends(get_current_tenant),
    db: Session = Depends(get_db)
):
    sources = db.query(Source).filter(Source.tenant_id == tenant.id).all()
    return sources
```

### 2. JWT —Å Auto-refresh

**Backend:**
- Access token: 30 –º–∏–Ω—É—Ç
- Refresh token: 7 –¥–Ω–µ–π
- Refresh endpoint: `/api/v1/auth/refresh`

**Frontend:**
- Axios interceptor –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç 401
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç refresh endpoint
- Retry –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º
- –ï—Å–ª–∏ refresh fails ‚Üí logout

```typescript
apiClient.interceptors.response.use(
  (response) => response,
  async (error) => {
    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true;
      const newToken = await refreshAccessToken();
      apiClient.defaults.headers.common['Authorization'] = `Bearer ${newToken}`;
      return apiClient(originalRequest);
    }
    return Promise.reject(error);
  }
);
```

### 3. Telegram Session Encryption

**–ü—Ä–æ–±–ª–µ–º–∞:** Telegram StringSession —Å–æ–¥–µ—Ä–∂–∏—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–µ–º Fernet symmetric encryption (cryptography.fernet)
- `ENCRYPTION_KEY` –≤ .env (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `Fernet.generate_key()`)
- `core/encryption.py`:
  ```python
  def encrypt_data(data: str) -> str:
      return fernet.encrypt(data.encode()).decode()

  def decrypt_data(encrypted_data: str) -> str:
      return fernet.decrypt(encrypted_data.encode()).decode()
  ```
- –í –ë–î —Ö—Ä–∞–Ω–∏–º `session_encrypted: String` (base64)

### 4. Background Worker —Å APScheduler

**–ü–æ—á–µ–º—É APScheduler:**
- –ù–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ async/await
- –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å FastAPI
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç Celery)
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è MVP

**Lifecycle management:**
```python
@asynccontextmanager
async def lifespan(app: FastAPI):
    # Startup
    worker = MessageCollectorWorker(db_session)
    worker.start(interval_minutes=5)
    yield
    # Shutdown
    worker.stop()

app = FastAPI(lifespan=lifespan)
```

### 5. LLM Integration

**Architecture:**
- OpenAI-compatible API —á–µ—Ä–µ–∑ LiteLLM Proxy
- –ü—Ä—è–º—ã–µ HTTP requests —á–µ—Ä–µ–∑ httpx (async)
- –ú–æ–¥–µ–ª—å: gpt-5-mini (400K context, –Ω–∏–∑–∫–∞—è —Ü–µ–Ω–∞)
- Timeout: 120 —Å–µ–∫—É–Ω–¥
- Error handling: retry –Ω–∞ network errors, fallback –Ω–∞ —Ç–∞–π–º–∞—É—Ç—ã

**Message Analysis Flow:**
```
1. MessageCollectorWorker —Å–æ–±–∏—Ä–∞–µ—Ç –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
2. RuleProcessor –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
   - –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ tenant'–∞
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ –≤—ã–∑—ã–≤–∞–µ—Ç LLMService.analyze_message_with_rule()
   - LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: is_match, score, reasoning
3. –ï—Å–ª–∏ score >= threshold:
   - –í—ã–∑—ã–≤–∞–µ—Ç LLMService.extract_lead_info() –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π
   - –°–æ–∑–¥–∞–µ—Ç Lead –≤ –ë–î
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
```

### 6. Docker Multi-service Architecture

**–°–µ—Ä–≤–∏—Å—ã:**
1. **postgres** - PostgreSQL 15 (port 5433)
2. **redis** - Redis 7 (port 6380)
3. **backend** - FastAPI API server (port 8001)
4. **worker** - Message collector background worker
5. **frontend** - Next.js web interface (port 3002)

**Volumes:**
- `postgres_data` - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (persistent)
- `redis_data` - Redis persistence
- `telegram_sessions` - Telegram session files (shared –º–µ–∂–¥—É backend –∏ worker)

**Networking:**
- Custom bridge network `telegram-monitor-network`
- –°–µ—Ä–≤–∏—Å—ã –æ–±—â–∞—é—Ç—Å—è –ø–æ –∏–º–µ–Ω–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (backend, postgres, redis)
- Healthchecks –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (backend –∂–¥–µ—Ç postgres + redis)

**Hot Reload:**
- Backend: –∫–æ–¥ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è read-only, uvicorn --reload
- Frontend: –∫–æ–¥ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è read-write (Next.js –ø–∏—à–µ—Ç –≤ .next), hot module replacement
- Worker: –∫–æ–¥ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è read-only, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ `docker-compose restart worker`

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ö–ª—é—á–µ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã:

**tenants:**
- `id` (UUID, PK)
- `name` (String)
- `plan` (String: free, pro, enterprise)
- `created_at`, `updated_at`

**users:**
- `id` (UUID, PK)
- `tenant_id` (UUID, FK ‚Üí tenants)
- `email` (String, unique)
- `full_name` (String)
- `hashed_password` (String)
- `is_active`, `is_verified`
- `notification_preferences` (JSON)
- `created_at`, `updated_at`

**telegram_accounts:**
- `id` (UUID, PK)
- `tenant_id` (UUID, FK ‚Üí tenants)
- `phone` (String)
- `session_encrypted` (String) ‚Üê Fernet encrypted base64
- `username` (String, nullable)
- `status` (String: active, inactive, failed)
- `last_active_at`
- `created_at`, `updated_at`

**sources:**
- `id` (UUID, PK)
- `tenant_id` (UUID, FK ‚Üí tenants)
- `telegram_account_id` (UUID, FK ‚Üí telegram_accounts)
- `tg_id` (BigInt) ‚Üê Telegram channel/chat ID
- `type` (String: channel, group, chat)
- `username` (String, nullable)
- `title` (String)
- `subscribers_count` (Int, nullable)
- `is_active` (Boolean, default=True)
- `tags` (ARRAY[String])
- `created_at`, `updated_at`

**messages:**
- `id` (UUID, PK)
- `source_id` (UUID, FK ‚Üí sources)
- `tg_message_id` (BigInt) ‚Üê ID –≤ Telegram
- `text` (Text)
- `sender_id` (BigInt, nullable)
- `forward_from` (String, nullable)
- `date` (DateTime)
- `media_type` (String, nullable)
- `views_count` (Int, nullable)
- `links` (ARRAY[String])
- `created_at`

**rules:**
- `id` (UUID, PK)
- `tenant_id` (UUID, FK ‚Üí tenants)
- `name` (String)
- `description` (Text) ‚Üê LLM prompt
- `is_active` (Boolean)
- `source_ids` (ARRAY[UUID]) ‚Üê –°–≤—è–∑–∞–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
- `min_score` (Float, default=0.7) ‚Üê –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π score –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ª–∏–¥–∞
- `created_at`, `updated_at`

**leads:**
- `id` (UUID, PK)
- `tenant_id` (UUID, FK ‚Üí tenants)
- `message_id` (UUID, FK ‚Üí messages)
- `rule_id` (UUID, FK ‚Üí rules)
- `status` (Enum: new, contacted, qualified, won, lost)
- `score` (Float) ‚Üê –û—Ç LLM (0-1)
- `llm_analysis` (JSON) ‚Üê Reasoning, extracted info
- `notes` (Text, nullable) ‚Üê –ó–∞–º–µ—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `assigned_to` (UUID, FK ‚Üí users, nullable)
- `created_at`, `updated_at`

**notifications:**
- `id` (UUID, PK)
- `tenant_id` (UUID, FK ‚Üí users) ‚Üê –ü–æ–ª—É—á–∞—Ç–µ–ª—å
- `type` (Enum: lead_created, lead_status_changed, lead_assigned, rule_triggered, system)
- `title` (String)
- `message` (Text)
- `related_lead_id` (UUID, FK ‚Üí leads, nullable)
- `extra_data` (Text, nullable) ‚Üê JSON metadata (RENAMED from 'metadata' to avoid SQLAlchemy conflict)
- `is_read` (Boolean, default=False)
- `read_at` (DateTime, nullable)
- `created_at`, `updated_at`

### –ò–Ω–¥–µ–∫—Å—ã:

```sql
-- Performance indexes
CREATE INDEX idx_messages_source_tg_id ON messages(source_id, tg_message_id);
CREATE INDEX idx_messages_date ON messages(date DESC);
CREATE INDEX idx_leads_tenant_status ON leads(tenant_id, status);
CREATE INDEX idx_leads_created_at ON leads(created_at DESC);
CREATE INDEX idx_leads_score ON leads(score DESC);
CREATE INDEX idx_sources_tenant_active ON sources(tenant_id, is_active);
CREATE INDEX idx_rules_tenant_active ON rules(tenant_id, is_active);
CREATE INDEX idx_notifications_tenant_read ON notifications(tenant_id, is_read);
```

---

## üìù Environment Variables

### Backend (.env)

```env
# Application
APP_NAME=Telegram Lead Monitor
APP_VERSION=0.1.0
DEBUG=True

# Server
HOST=0.0.0.0
PORT=8000

# Database (using port 5433 to avoid conflict with existing postgres)
DATABASE_URL=postgresql://telegram_monitor:dev_password@localhost:5433/telegram_monitor

# Redis (using port 6380 to avoid conflict with existing redis)
REDIS_URL=redis://localhost:6380/0

# JWT Settings
SECRET_KEY=dev-secret-key-for-local-testing-only-change-in-production-12345
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# Telegram API (Get from https://my.telegram.org)
TELEGRAM_API_ID=your_api_id
TELEGRAM_API_HASH=your_api_hash

# Encryption (Generate using: from cryptography.fernet import Fernet; print(Fernet.generate_key().decode()))
ENCRYPTION_KEY=your-fernet-encryption-key

# LLM Integration (llm.codenrock.com)
# LiteLLM Proxy with OpenAI-compatible API
LLM_API_URL=https://llm.codenrock.com
LLM_API_KEY=sk-litellm-5d72bc9cb76846620c011e7708fcf4c9
LLM_MODEL=gpt-5-mini
LLM_TIMEOUT=120

# Email Settings (for verification emails)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
SMTP_FROM_EMAIL=noreply@telegram-lead-monitor.com
SMTP_FROM_NAME=Telegram Lead Monitor

# Frontend URL
FRONTEND_URL=http://localhost:3002

# CORS Origins (comma-separated)
CORS_ORIGINS=["http://localhost:3002"]

# Verification Token
VERIFICATION_TOKEN_EXPIRE_HOURS=24
```

### Frontend (.env.local)

```env
NEXT_PUBLIC_API_URL=http://localhost:8001
```

### Docker Environment Variables

–í `docker-compose.yml` –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

```yaml
backend:
  environment:
    - DATABASE_URL=postgresql://telegram_monitor:dev_password@postgres:5432/telegram_monitor
    - REDIS_URL=redis://redis:6379/0

frontend:
  environment:
    - NEXT_PUBLIC_API_URL=http://localhost:8001
```

**–í–∞–∂–Ω–æ:** –í–Ω—É—Ç—Ä–∏ Docker —Å–µ—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (postgres, redis), –∞ –Ω–µ localhost.

---

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repo-url>
cd telegram-lead-monitor

# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å backend/.env
cp backend/.env.example backend/.env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å backend/.env:
# - TELEGRAM_API_ID
# - TELEGRAM_API_HASH
# - LLM_API_KEY (—É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω)

# 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å frontend/.env.local
cp frontend/.env.local.example frontend/.env.local
# –ü–æ—Ä—Ç —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (8001)

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up -d

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker-compose ps

# 6. –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
# Frontend: http://localhost:3002
# API Docs: http://localhost:8001/docs
```

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–±–µ–∑ Docker)

**Prerequisites:**
- Python 3.10+
- Node.js 18+
- PostgreSQL 15+
- Redis 7+

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL –∏ Redis –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –ø–æ—Ä—Ç–∞—Ö 5433 –∏ 6380
# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Docker —Ç–æ–ª—å–∫–æ –¥–ª—è –ë–î:
docker-compose up -d postgres redis

# 2. Backend setup
cd backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt

# 3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å backend
uvicorn app.main:app --reload --host 0.0.0.0 --port 8001

# 5. Frontend setup (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
cd frontend
npm install

# 6. –ó–∞–ø—É—Å—Ç–∏—Ç—å frontend
npm run dev
# Frontend –±—É–¥–µ—Ç –Ω–∞ http://localhost:3002
```

### Database Migrations

```bash
# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
cd backend
source venv/bin/activate
alembic revision --autogenerate -m "–æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic downgrade -1

# –ò—Å—Ç–æ—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
alembic history
```

---

## üîç Debugging

### Backend Logs

```bash
# Docker
docker logs -f telegram-monitor-backend

# –õ–æ–∫–∞–ª—å–Ω–æ
# –õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ stdout —á–µ—Ä–µ–∑ uvicorn
```

### Worker Logs

```bash
docker logs -f telegram-monitor-worker

# –ö–ª—é—á–µ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
# - "Starting message collection job..."
# - "Collected X messages from Y sources"
# - "Processing message with Z active rules"
# - "Created lead with score X"
```

### Frontend Logs

```bash
# Docker
docker logs -f telegram-monitor-frontend

# –õ–æ–∫–∞–ª—å–Ω–æ
# Next.js dev server –≤—ã–≤–æ–¥–∏—Ç –≤ –∫–æ–Ω—Å–æ–ª—å
# Browser console –¥–ª—è frontend errors
```

### Database Access

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ PostgreSQL
docker exec -it telegram-monitor-postgres psql -U telegram_monitor -d telegram_monitor

# –ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
SELECT COUNT(*) FROM messages;
SELECT * FROM sources WHERE is_active = true;
SELECT * FROM telegram_accounts;
SELECT * FROM rules WHERE is_active = true;
SELECT * FROM leads ORDER BY created_at DESC LIMIT 10;

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
SELECT s.title, m.text, m.date
FROM messages m
JOIN sources s ON m.source_id = s.id
ORDER BY m.date DESC LIMIT 5;
```

### Redis Access

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Redis
docker exec -it telegram-monitor-redis redis-cli

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª—é—á–∏
KEYS *

# –ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
GET key_name

# –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
FLUSHDB
```

---

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (100% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª MVP):

1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:**
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - JWT —Å auto-refresh tokens
   - –ú—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å (–∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)
   - –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ routes

2. **Telegram Integration:**
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Telegram –∞–∫–∫–∞—É–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ MTProto
   - –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤/–≥—Ä—É–ø–ø
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤ –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
   - –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ë–î —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏

3. **LLM Analysis:**
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å gpt-5-mini —á–µ—Ä–µ–∑ llm.codenrock.com
   - –ê–Ω–∞–ª–∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ª–∏–¥–∞—Ö
   - Score calculation (0-1)

4. **Rules Engine:**
   - –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª —Å LLM –ø—Ä–æ–º–ø—Ç–∞–º–∏
   - –°–≤—è–∑—å –ø—Ä–∞–≤–∏–ª —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π score threshold

5. **Leads Management:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ª–∏–¥–æ–≤
   - –°—Ç–∞—Ç—É—Å—ã: new ‚Üí contacted ‚Üí qualified ‚Üí won/lost
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
   - –ó–∞–º–µ—Ç–∫–∏ –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
   - Export to CSV

6. **Notifications:**
   - Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –ª–∏–¥–∞—Ö
   - In-app notifications
   - Telegram Bot —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚≠ê
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

7. **Analytics:**
   - –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
   - –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã —Å–æ–∑–¥–∞–Ω–∏—è –ª–∏–¥–æ–≤
   - –í–æ—Ä–æ–Ω–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
   - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏ –ø—Ä–∞–≤–∏–ª
   - –¢—Ä–µ–Ω–¥—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

8. **UI:**
   - Dashboard —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Telegram –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º–∏
   - Dashboard –ª–∏–¥–æ–≤
   - Analytics page
   - Settings page

9. **Docker:**
   - –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
   - Multi-stage builds
   - Hot reload –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
   - Health checks
   - Volume persistence

### üéØ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production:

**–ì–æ—Ç–æ–≤–æ:**
- ‚úÖ –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ MVP
- ‚úÖ Docker setup
- ‚úÖ Database migrations
- ‚úÖ Environment configuration
- ‚úÖ API documentation (Swagger)
- ‚úÖ Basic testing

**–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è production:**
- ‚ö†Ô∏è HTTPS/SSL certificates
- ‚ö†Ô∏è Production database (–Ω–µ dev_password)
- ‚ö†Ô∏è Production SECRET_KEY (–Ω–µ dev key)
- ‚ö†Ô∏è Rate limiting
- ‚ö†Ô∏è Monitoring (Sentry, Prometheus)
- ‚ö†Ô∏è Backup strategy
- ‚ö†Ô∏è CI/CD pipeline
- ‚ö†Ô∏è Load balancing (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- ‚ö†Ô∏è Comprehensive testing (unit + integration + e2e)

---

## üîë –í–∞–∂–Ω—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Telegram Bot Lifecycle

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å –±–æ—Ç–∞ –≤–º–µ—Å—Ç–µ —Å backend –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞?

**–†–µ—à–µ–Ω–∏–µ:** FastAPI lifespan context manager –≤ `main.py`:

```python
@asynccontextmanager
async def lifespan(app: FastAPI):
    # Startup
    logger.info("Starting application...")
    message_collector_worker.start(interval_minutes=interval)
    await telegram_bot_service.start_bot()  # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

    yield

    # Shutdown
    logger.info("Shutting down application...")
    message_collector_worker.stop()
    await telegram_bot_service.stop_bot()  # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞

app = FastAPI(lifespan=lifespan)
```

**–í–∞–∂–Ω–æ:**
- –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ —Ç–æ–º –∂–µ –ø—Ä–æ—Ü–µ—Å—Å–µ —á–µ—Ä–µ–∑ `asyncio`
- Long polling –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –∫–æ—Ä—É—Ç–∏–Ω–µ
- –ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ backend –±–æ—Ç —Ç–∞–∫–∂–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è gracefully

### Database Session Management –≤ async context

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å DB session –≤ async –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞?

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `get_session_local()` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è SessionLocal –∫–ª–∞—Å—Å–∞:

```python
async def _cmd_verify(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
    SessionLocal = get_session_local()  # –ü–æ–ª—É—á–∞–µ–º –∫–ª–∞—Å—Å
    db = SessionLocal()  # –°–æ–∑–¥–∞–µ–º —Å–µ—Å—Å–∏—é
    try:
        # —Ä–∞–±–æ—Ç–∞ —Å –ë–î
        db.commit()
    finally:
        db.close()
```

**–í–∞–∂–Ω–æ:**
- –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `from app.database import SessionLocal` - –µ–≥–æ —Ç–∞–º –Ω–µ—Ç!
- –í–°–ï–ì–î–ê –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —Å–µ—Å—Å–∏—é –≤ `finally` –±–ª–æ–∫–µ
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Depends(get_db)` –≤ async –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö –±–æ—Ç–∞ - —ç—Ç–æ —Ç–æ–ª—å–∫–æ –¥–ª—è FastAPI endpoints

### Telegram Markdown Parsing

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∞ "Can't parse entities" –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Markdown.

**–ü—Ä–∏—á–∏–Ω–∞:** Telegram –æ—á–µ–Ω—å —Å—Ç—Ä–æ–≥ –∫ Markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:
- –ù—É–∂–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã: `_`, `*`, `[`, `]`, `(`, `)`, `~`, `` ` ``, `>`, `#`, `+`, `-`, `=`, `|`, `{`, `}`, `.`, `!`
- Backticks –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–∞—Ä–Ω—ã–º–∏
- –ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å backticks –≤–Ω—É—Ç—Ä–∏ –¥—Ä—É–≥–∏—Ö —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–π

**–†–µ—à–µ–Ω–∏–µ:**
- –õ–∏–±–æ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `parse_mode="Markdown"` (—Å–∞–º–æ–µ –ø—Ä–æ—Å—Ç–æ–µ)
- –õ–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `parse_mode="MarkdownV2"` –∏ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã
- –õ–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `parse_mode="HTML"` –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞

**–ü—Ä–∏–º–µ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:**
```python
message = (
    "üëã Welcome to Telegram Lead Monitor!\n\n"
    f"Your Chat ID: {chat_id}\n\n"  # –ë–µ–∑ backticks!
    "To connect your account:\n"
    "1. Copy your Chat ID above\n"
    "..."
)
await update.message.reply_text(message)  # –ë–ï–ó parse_mode
```

### Dependency Conflicts Resolution

**–ü—Ä–æ–±–ª–µ–º–∞:** `python-telegram-bot==20.7` –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å `httpx==0.26.0`

**–ü—Ä–∏—á–∏–Ω–∞:** `python-telegram-bot==20.7` —Ç—Ä–µ–±—É–µ—Ç `httpx~=0.25.2`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
2. –ü—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ –≤—ã–±–∏—Ä–∞–µ–º –≤–µ—Ä—Å–∏—é —Å–æ–≤–º–µ—Å—Ç–∏–º—É—é —Å–æ –≤—Å–µ–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
3. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ: downgrade httpx —Å 0.26.0 –¥–æ 0.25.2

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
```bash
pip install python-telegram-bot==20.7
# –°–º–æ—Ç—Ä–∏–º –Ω–∞ –æ—à–∏–±–∫–∏ pip –æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö
pip list | grep httpx
```

### Logger vs Print –≤ Docker

**–ü—Ä–æ–±–ª–µ–º–∞:** –õ–æ–≥–∏ –∏–∑ `logger.info()` –≤ lifespan –Ω–µ –ø–æ—è–≤–ª—è–ª–∏—Å—å –≤ `docker logs`

**–ü—Ä–∏—á–∏–Ω–∞:** uvicorn –≤ —Ä–µ–∂–∏–º–µ `--reload` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç multiprocessing, –∏ child process –º–æ–∂–µ—Ç –Ω–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å logger

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `print(..., flush=True)` –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:

```python
async def start_bot(self):
    print("=== Starting Telegram bot ===", flush=True)  # –í—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–æ
    logger.info("=== Starting Telegram bot ===")  # –ú–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å

    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥

    print("‚úÖ Telegram bot started successfully!", flush=True)
```

**–í–∞–∂–Ω–æ:**
- `flush=True` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ print —Ç–æ–ª—å–∫–æ –¥–ª—è startup/shutdown –ª–æ–≥–æ–≤
- –î–ª—è runtime –ª–æ–≥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ logger (–æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)

### Environment Variables –≤ Docker

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. `.env` —Ñ–∞–π–ª –≤ `backend/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
2. `docker-compose.yml` –ø–µ—Ä–µ–¥–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
   ```yaml
   backend:
     env_file:
       - ./backend/.env
   ```
3. `app/config.py` —á–∏—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `pydantic-settings`

**–í–∞–∂–Ω–æ:**
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env` –ù–ï –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- –ù—É–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å `env_file` –≤ docker-compose.yml
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: `docker exec <container> printenv | grep TELEGRAM`

### Hot Reload –≤ Docker

**Backend:**
- –ö–æ–¥ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ volume (–ù–ï read-only –¥–ª—è backend!)
- uvicorn —Å —Ñ–ª–∞–≥–æ–º `--reload`
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `.py` —Ñ–∞–π–ª–∞—Ö –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é—Ç —Å–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ù–û: –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `requirements.txt` —Ç—Ä–µ–±—É—é—Ç rebuild –æ–±—Ä–∞–∑–∞

**Frontend:**
- –ö–æ–¥ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ volume (read-write –¥–ª—è Next.js)
- Next.js dev server —Å hot module replacement
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `.tsx/.ts` –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- –ù–û: –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `package.json` —Ç—Ä–µ–±—É—é—Ç `npm install` –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

**Worker:**
- –ö–æ–¥ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ volume (read-only)
- –ù–ï–¢ hot reload (APScheduler –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)
- –¢—Ä–µ–±—É–µ—Ç `docker-compose restart worker` –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## üöÄ Roadmap: –ü–æ—Å–ª–µ MVP

### Phase 2: Production Ready

**Security:**
- [ ] Rate limiting –¥–ª—è API endpoints
- [ ] CAPTCHA –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
- [ ] IP whitelisting –¥–ª—è admin endpoints
- [ ] Security headers (CORS, CSP, HSTS)
- [ ] Audit logging
- [ ] Secret management (Vault, AWS Secrets Manager)

**Monitoring & Observability:**
- [ ] Sentry –¥–ª—è error tracking
- [ ] Prometheus + Grafana –¥–ª—è –º–µ—Ç—Ä–∏–∫
- [ ] Structured logging (JSON logs)
- [ ] APM (Application Performance Monitoring)
- [ ] Uptime monitoring (UptimeRobot, Pingdom)

**Scalability:**
- [ ] Database connection pooling tuning
- [ ] Redis caching strategy
- [ ] CDN –¥–ª—è static assets
- [ ] Load balancer (nginx, Traefik)
- [ ] Horizontal scaling workers

**DevOps:**
- [ ] CI/CD pipeline (GitHub Actions, GitLab CI)
- [ ] Automated testing –≤ pipeline
- [ ] Blue-green deployment
- [ ] Database backup automation
- [ ] Disaster recovery plan

### Phase 3: Enhanced Features

**Telegram:**
- [‚úÖ] Telegram Bot –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–ó–ê–í–ï–†–®–ï–ù–û 9 –¥–µ–∫–∞–±—Ä—è 2025)
- [ ] –ì—Ä—É–ø–ø–∞ –≤ Telegram –¥–ª—è –∫–æ–º–∞–Ω–¥—ã
- [ ] Direct message monitoring (—Å —Å–æ–≥–ª–∞—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫ –ø–æ—Å—Ç–∞–º

**LLM:**
- [ ] A/B testing —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
- [ ] Custom prompt templates
- [ ] Prompt versioning
- [ ] Multi-language support
- [ ] Entity extraction —É–ª—É—á—à–µ–Ω–∏—è (NER)

**Analytics:**
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤ –≤ PDF
- [ ] Scheduled email reports
- [ ] Custom dashboards
- [ ] Advanced filters
- [ ] Cohort analysis
- [ ] Predictive analytics (ML –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –ª–∏–¥–∞)

**Integrations:**
- [ ] CRM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (Salesforce, HubSpot, Pipedrive)
- [ ] Webhooks –¥–ª—è external systems
- [ ] Zapier integration
- [ ] Slack notifications
- [ ] API webhooks –¥–ª—è custom integrations

**User Management:**
- [ ] Teams –∏ —Ä–æ–ª–∏ (admin, manager, viewer)
- [ ] Permissions system
- [ ] User activity audit log
- [ ] Invite system
- [ ] OAuth (Google, GitHub login)

### Phase 4: Advanced Features

**AI Enhancements:**
- [ ] Lead scoring ML model (–æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö)
- [ ] Automatic rule suggestions
- [ ] Smart deduplication (–ø–æ—Ö–æ–∂–∏–µ –ª–∏–¥—ã)
- [ ] Sentiment analysis
- [ ] Language detection –∏ translation

**TGStat Integration:**
- [ ] –ü–æ–∏—Å–∫ –∫–∞–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ TGStat API
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–Ω–∞–ª–æ–≤
- [ ] –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

**Mobile:**
- [ ] Mobile-responsive design improvements
- [ ] Progressive Web App (PWA)
- [ ] React Native app (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**Billing:**
- [ ] Stripe integration
- [ ] Subscription plans (Free, Pro, Enterprise)
- [ ] Usage-based billing
- [ ] Invoice generation

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –î–æ–∫—É–º–µ–Ω—Ç—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ:

- **README.md** - –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, quick start guide
- **LLM_MODELS.md** - –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö LLM –º–æ–¥–µ–ª–µ–π, —Å—Ç–æ–∏–º–æ—Å—Ç—å, use cases
- **DOCKER.md** - Docker setup, troubleshooting, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **DEPLOYMENT.md** - Deployment –Ω–∞ production (DigitalOcean, AWS, etc.)
- **CLAUDE.md** (—ç—Ç–æ—Ç —Ñ–∞–π–ª) - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### API Documentation:

- **Swagger UI**: http://localhost:8001/docs
- **ReDoc**: http://localhost:8001/redoc

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# Makefile shortcuts
make setup          # –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
make docker-up      # –ó–∞–ø—É—Å—Ç–∏—Ç—å Docker —Å–µ—Ä–≤–∏—Å—ã
make docker-down    # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker —Å–µ—Ä–≤–∏—Å—ã
make docker-build   # –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã
make docker-logs    # –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make backend        # –õ–æ–≥–∏ backend
make frontend       # –õ–æ–≥–∏ frontend
make worker         # –õ–æ–≥–∏ worker
make migrate        # –ü—Ä–∏–º–µ–Ω–∏—Ç—å DB –º–∏–≥—Ä–∞—Ü–∏–∏
make test           # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
make clean          # –û—á–∏—Å—Ç–∏—Ç—å volumes –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
```

---

## üéØ MVP Success Criteria ‚úÖ

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö 9 —ç—Ç–∞–ø–æ–≤, MVP —É–º–µ–µ—Ç:

1. ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Telegram –∞–∫–∫–∞—É–Ω—Ç–æ–≤ (MTProto)
3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤/–≥—Ä—É–ø–ø –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
4. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
5. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª —Å LLM –ø—Ä–æ–º–ø—Ç–∞–º–∏
6. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ LLM (gpt-5-mini)
7. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ª–∏–¥–æ–≤ –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏
8. ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–∏–¥–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏
9. ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –ª–∏–¥–∞—Ö (email + in-app)
10. ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –≥—Ä–∞—Ñ–∏–∫–∏

**–í—Å–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã! MVP –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ**

---

## üìä –ü—Ä–æ–≥—Ä–µ—Å—Å MVP

**–ó–∞–≤–µ—Ä—à–µ–Ω–æ:** 9/9 —ç—Ç–∞–ø–æ–≤ ‚úÖ (100%)

**Timeline:**
- ‚úÖ Stage 1-3: 7 –¥–Ω–µ–π (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
- ‚úÖ Stage 4: 4 –¥–Ω—è (Telegram integration)
- ‚úÖ Stage 5: 4 –¥–Ω—è (LLM + Rules)
- ‚úÖ Stage 6: 3 –¥–Ω—è (Frontend –¥–ª—è Rules & Leads)
- ‚úÖ Stage 7: 1 –¥–µ–Ω—å (–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
- ‚úÖ Stage 8: 1 –¥–µ–Ω—å (–ê–Ω–∞–ª–∏—Ç–∏–∫–∞)
- ‚úÖ Stage 9: 2 –¥–Ω—è (Testing & Docs) + Docker setup

**Total:** 23 –¥–Ω—è (–ø–æ –ø–ª–∞–Ω—É)
**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏:** ~12 –¥–Ω–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ + Docker setup

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**Telegram Lead Monitor MVP –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤!**

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã:
- ‚úÖ Telegram integration —Å MTProto
- ‚úÖ LLM –∞–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ gpt-5-mini
- ‚úÖ Rules engine —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–æ–∑–¥–∞–Ω–∏–µ–º –ª–∏–¥–æ–≤
- ‚úÖ –ü–æ–ª–Ω—ã–π UI –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- ‚úÖ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!**

### –ö–∞–∫ –Ω–∞—á–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å environment variables (Telegram API, LLM API)
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å `docker-compose up -d`
3. –û—Ç–∫—Ä—ã—Ç—å http://localhost:3002
4. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
5. –ü–æ–¥–∫–ª—é—á–∏—Ç—å Telegram –∞–∫–∫–∞—É–Ω—Ç
6. –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (–∫–∞–Ω–∞–ª—ã)
7. –°–æ–∑–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
8. –ñ–¥–∞—Ç—å –ª–∏–¥—ã! üéØ

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** Production deployment (—Å–º. DEPLOYMENT.md)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 9 –¥–µ–∫–∞–±—Ä—è 2025, 16:30
**–°—Ç–∞—Ç—É—Å:** ‚úÖ MVP Complete + Telegram Bot Notifications - Ready for Production! üöÄ
